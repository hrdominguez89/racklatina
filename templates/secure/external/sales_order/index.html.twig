{% extends 'base.html.twig' %}

{% block title %}
    Pedidos Relacionados
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    {% endblock %}

    {% block body %}
        <div class="container-fluid">

            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-sm-flex align-items-center justify-content-between bg-galaxy-transparent">
                        <div class="page-title-right">
                            <ol class="breadcrumb m-0">
                                <li class="breadcrumb-item active">
                                    Mi portal
                                </li>
                                <li class="breadcrumb-item active">
                                    Pedidos
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-12">
                    <table id="tabla-pedidos" class="table table-striped">
                        <thead>
                            <tr>
                                <th>
                                    Cliente
                                </th>
                                <th>
                                    Raz√≥n Social
                                </th>
                                <th>
                                    Orden Compra
                                </th>
                                <th>
                                    Fecha Pedido
                                </th>
                                <th>
                                    Detalle
                                </th>
                                <th>
                                    Acciones
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pedido in pedidos %}
                                <tr>
                                    <td>
                                        {{ pedido.cliente }}
                                    </td>
                                    <td>
                                        {{ pedido.razonsocial }}
                                    </td>
                                    <td>
                                        {{ pedido.ordencompra }}
                                    </td>
                                    <td>
                                        {{ pedido.fechapedido ? pedido.fechapedido|date('d/m/Y') : '' }}
                                    </td>
                                    <td>
                                        {{ pedido.detalle }}
                                    </td>
                                    <td>
                                        <button onclick ="verDetalleOrdenDeCompra({{pedido.info}})"  class="btn btn-outline-primary btn-sm">Ver en detalle</button>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    {% endblock %}

    {% block javascripts %}
        {{ parent() }}
        <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
        <script>
        document.addEventListener('DOMContentLoaded', function () {
            $('#tabla-pedidos').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                },
                order: [[3, 'desc']]
            });
        });

        function verDetalleOrdenDeCompra(info) {
    // Crear un formulario temporal para enviar los datos via POST
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '{{ path("app_secure_external_sales_order_sales_order_ver_en_detalle") }}';
    
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'info';
    input.value = JSON.stringify(info);
    
    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
}

    </script>
    {% endblock %}
    